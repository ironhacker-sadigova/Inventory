<?php
use MyCLabs\MUIH\GenericTag;
use MyCLabs\MUIH\GenericVoidTag;

/**
 * @author valentin.claras
 * @author sidoine.tardieu
 * @package Orga
 * Arbre des axes d'un organization.
 */
$editLabelInput = new GenericVoidTag('input');
$editLabelInput->setAttribute('name', 'editAxis_label');
$editLabelInput->setAttribute('type', 'text');
$editLabelInput->setAttribute('id', 'editAxis_label');
$editLabelInput->addClass('form-control');
$editLabelWrapper = new GenericTag('div', $editLabelInput);
$editLabelWrapper->addClass('col-xs-10');
$editLabelLabel = new GenericTag('label', ___('UI', 'name', 'label'));
$editLabelLabel->setAttribute('for', 'editAxis_label');
$editLabelLabel->addClass('control-label');
$editLabelLabel->addClass('col-xs-2');
$editLabelGroup = new GenericTag('div');
$editLabelGroup->addClass('form-group');
$editLabelGroup->appendContent($editLabelLabel);
$editLabelGroup->appendContent($editLabelWrapper);

$editRefInput = new GenericVoidTag('input');
$editRefInput->setAttribute('name', 'editAxis_ref');
$editRefInput->setAttribute('type', 'text');
$editRefInput->setAttribute('id', 'editAxis_ref');
$editRefInput->addClass('form-control');
$editRefWrapper = new GenericTag('div', $editRefInput);
$editRefWrapper->addClass('col-xs-10');
$editRefLabel = new GenericTag('label', ___('UI', 'name', 'identifier'));
$editRefLabel->setAttribute('for', 'editAxis_ref');
$editRefLabel->addClass('control-label');
$editRefLabel->addClass('col-xs-2');
$editRefGroup = new GenericTag('div');
$editRefGroup->addClass('form-group');
$editRefGroup->appendContent($editRefLabel);
$editRefGroup->appendContent($editRefWrapper);

$editContextualizingText = new GenericTag('div', ___('Orga', 'axis', 'contextualizingLabel'));
$editContextualizingText->addClass('col-xs-10');
$editContextualizingText->addClass('col-xs-offset-2');
$editContextualizingExplanations = new GenericTag('div');
$editContextualizingExplanations->addClass('form-group');
$editContextualizingExplanations->appendContent($editContextualizingText);

$editContextualizingInputFalse = new GenericVoidTag('input');
$editContextualizingInputFalse->setAttribute('name', 'editAxis_isContextualizing');
$editContextualizingInputFalse->setAttribute('type', 'radio');
$editContextualizingInputFalse->setAttribute('id', 'editAxis_notContextualizing');
$editContextualizingInputFalse->setAttribute('value', 'notContextualizing');
$editContextualizingInputFalse->addClass('');
$editContextualizingLabelFalse = new GenericTag('label', ___('Orga', 'axis', 'notContextualizingOption'));
$editContextualizingLabelFalse->appendContent($editContextualizingInputFalse);
$editContextualizingLabelFalse->setAttribute('for', 'editAxis_notContextualizing');
$editContextualizingLabelFalse->addClass('radio-inline');
$editContextualizingInputTrue = new GenericVoidTag('input');
$editContextualizingInputTrue->setAttribute('name', 'editAxis_isContextualizing');
$editContextualizingInputTrue->setAttribute('type', 'radio');
$editContextualizingInputTrue->setAttribute('id', 'editAxis_contextualizing');
$editContextualizingInputTrue->setAttribute('value', 'contextualizing');
$editContextualizingInputTrue->addClass('');
$editContextualizingLabelTrue = new GenericTag('label', ___('Orga', 'axis', 'contextualizingOption'));
$editContextualizingLabelTrue->appendContent($editContextualizingInputTrue);
$editContextualizingLabelTrue->setAttribute('for', 'editAxis_contextualizing');
$editContextualizingLabelTrue->addClass('radio-inline');
$editContextualizingWrapper = new GenericTag('div');
$editContextualizingWrapper->appendContent($editContextualizingLabelFalse);
$editContextualizingWrapper->appendContent($editContextualizingLabelTrue);
$editContextualizingWrapper->addClass('col-xs-10');
$editContextualizingWrapper->addClass('col-xs-offset-2');
$editContextualizingGroup = new GenericTag('div');
$editContextualizingGroup->addClass('form-group');
$editContextualizingGroup->appendContent($editContextualizingWrapper);

$addLabelInput = new GenericVoidTag('input');
$addLabelInput->setAttribute('name', 'addAxis_label');
$addLabelInput->setAttribute('type', 'text');
$addLabelInput->setAttribute('id', 'addAxis_label');
$addLabelInput->addClass('form-control');
$addLabelWrapper = new GenericTag('div', $addLabelInput);
$addLabelWrapper->addClass('col-xs-10');
$addLabelLabel = new GenericTag('label', ___('UI', 'name', 'label'));
$addLabelLabel->setAttribute('for', 'addAxis_label');
$addLabelLabel->addClass('control-label');
$addLabelLabel->addClass('col-xs-2');
$addLabelGroup = new GenericTag('div');
$addLabelGroup->addClass('form-group');
$addLabelGroup->appendContent($addLabelLabel);
$addLabelGroup->appendContent($addLabelWrapper);

$addRefInput = new GenericVoidTag('input');
$addRefInput->setAttribute('name', 'addAxis_ref');
$addRefInput->setAttribute('type', 'text');
$addRefInput->setAttribute('id', 'addAxis_ref');
$addRefInput->addClass('form-control');
$addRefWrapper = new GenericTag('div', $addRefInput);
$addRefWrapper->addClass('col-xs-10');
$addRefLabel = new GenericTag('label', ___('UI', 'name', 'identifier'));
$addRefLabel->setAttribute('for', 'addAxis_ref');
$addRefLabel->addClass('control-label');
$addRefLabel->addClass('col-xs-2');
$addRefGroup = new GenericTag('div');
$addRefGroup->addClass('form-group');
$addRefGroup->appendContent($addRefLabel);
$addRefGroup->appendContent($addRefWrapper);

$addParentInput = new GenericTag('select');
$addParentInput->setAttribute('name', 'addAxis_parent');
$addParentInput->setAttribute('type', 'text');
$addParentInput->setAttribute('id', 'addAxis_parent');
$addParentInput->addClass('form-control');
$optionParent = new GenericTag('option');
$optionParent->setAttribute('value', '');
$addParentInput->appendContent($optionParent);
foreach ($this->eligibleParents as $parentAxis) {
    /** @var Orga_Model_Axis $parentAxis */
    $optionParent = new GenericTag('option', $this->translate($parentAxis->getLabel()));
    $optionParent->setAttribute('value', $parentAxis->getRef());
    $addParentInput->appendContent($optionParent);
}
$addParentWrapper = new GenericTag('div', $addParentInput);
$addParentWrapper->addClass('col-xs-10');
$addParentLabel = new GenericTag('label', ___('Orga', 'axis', 'parentAxisLabel'));
$addParentLabel->setAttribute('for', 'addAxis_parent');
$addParentLabel->addClass('control-label');
$addParentLabel->addClass('col-xs-2');
$addParentGroup = new GenericTag('div');
$addParentGroup->addClass('form-group');
$addParentGroup->appendContent($addParentLabel);
$addParentGroup->appendContent($addParentWrapper);

$addContextualizingText = new GenericTag('div', ___('Orga', 'axis', 'contextualizingLabel'));
$addContextualizingText->addClass('col-xs-10');
$addContextualizingText->addClass('col-xs-offset-2');
$addContextualizingExplanations = new GenericTag('div');
$addContextualizingExplanations->addClass('form-group');
$addContextualizingExplanations->appendContent($addContextualizingText);

$addContextualizingInputFalse = new GenericVoidTag('input');
$addContextualizingInputFalse->setAttribute('name', 'addAxis_isContextualizing');
$addContextualizingInputFalse->setAttribute('type', 'radio');
$addContextualizingInputFalse->setAttribute('id', 'addAxis_notContextualizing');
$addContextualizingInputFalse->setAttribute('value', 'notContextualizing');
$addContextualizingInputFalse->setBooleanAttribute('checked');
$addContextualizingInputFalse->addClass('');
$addContextualizingLabelFalse = new GenericTag('label', ___('Orga', 'axis', 'notContextualizingOption'));
$addContextualizingLabelFalse->appendContent($addContextualizingInputFalse);
$addContextualizingLabelFalse->setAttribute('for', 'addAxis_notContextualizing');
$addContextualizingLabelFalse->addClass('radio-inline');
$addContextualizingInputTrue = new GenericVoidTag('input');
$addContextualizingInputTrue->setAttribute('name', 'addAxis_isContextualizing');
$addContextualizingInputTrue->setAttribute('type', 'radio');
$addContextualizingInputTrue->setAttribute('id', 'addAxis_contextualizing');
$addContextualizingInputTrue->setAttribute('value', 'contextualizing');
$addContextualizingInputTrue->addClass('');
$addContextualizingLabelTrue = new GenericTag('label', ___('Orga', 'axis', 'contextualizingOption'));
$addContextualizingLabelTrue->appendContent($addContextualizingInputTrue);
$addContextualizingLabelTrue->setAttribute('for', 'addAxis_contextualizing');
$addContextualizingLabelTrue->addClass('radio-inline');
$addContextualizingWrapper = new GenericTag('div');
$addContextualizingWrapper->appendContent($addContextualizingLabelFalse);
$addContextualizingWrapper->appendContent($addContextualizingLabelTrue);
$addContextualizingWrapper->addClass('col-xs-10');
$addContextualizingWrapper->addClass('col-xs-offset-2');
$addContextualizingGroup = new GenericTag('div');
$addContextualizingGroup->addClass('form-group');
$addContextualizingGroup->appendContent($addContextualizingWrapper);

$addForm = new GenericTag('form');
$addForm->appendContent($addLabelGroup);
$addForm->appendContent($addRefGroup);
$addForm->appendContent($addParentGroup);
$addForm->appendContent($addContextualizingExplanations);
$addForm->appendContent($addContextualizingGroup);

$treeManage = new UI_Tree('editAxis', 'tree_axis', 'orga');
if ($this->idCell !== null) {
    $treeManage->addParam('idCell', $this->idCell);
}
$treeManage->addParam('idOrganization', $this->idOrganization);
$treeManage->addNode = true;
$treeManage->addPanelForm = $addForm;
$treeManage->addPanelTitle = ___('Orga', 'axis', 'addPanelTitle');
$treeManage->editPanelTitle = ___('Orga', 'axis', 'editPanelTitle');
$treeManage->setEditNode(false, true, [$editLabelGroup, $editRefGroup, $editContextualizingExplanations, $editContextualizingGroup]);
$treeManage->deleteNode = true;
$treeManage->expandAll = false;
$treeManage->collapseAll = false;
if ($this->display === false) {
    echo $treeManage->render();
} else {
    $treeManage->display();
}

$script = '';
$script .= '$(\'#editAxis_element\').change(function(e) {';
$script .= 'var idNode = $(this).val();';
$script .= '$(\'#editAxis_contextualizing\').attr(\'checked\', false);';
$script .= '$(\'#editAxis_Contextualizing\').removeAttr(\'checked\');';
$script .= '$(\'#editAxis_notContextualizing\').attr(\'checked\', false);';
$script .= '$(\'#editAxis_notContextualizing\').removeAttr(\'checked\');';
$script .= '$.get(';
$script .= '\'orga/tree_axis/getinfoedit?idOrganization='.$this->idOrganization.'&idNode=\' + idNode, ';
$script .= 'function(o){';
$script .= '$(\'#editAxis_label\').val(o.label);';
$script .= '$(\'#editAxis_ref\').val(o.ref);';
$script .= '$(\'input[name="editAxis_isContextualizing"]\').val([o.isContextualizing]);';
$script .= '}';
$script .= ').error(function(o) {';
$script .= 'errorHandler(o);';
$script .= '});';
$script .= '});';
$script .= '$(\'#editAxis_addPanel\').on(\'show.bs.modal\', function(e) {';
$script .= '$.get(';
$script .= '\'orga/tree_axis/getlistparents?idOrganization='.$this->idOrganization.'&idNode=\', ';
$script .= 'function(o){';
$script .= '$(\'#addAxis_parent\').formActionSetOptions(o);';
$script .= '}';
$script .= ').error(function(o) {';
$script .= 'errorHandler(o);';
$script .= '});';
$script .= '});';
$script .= 'refFromLabel(\'addAxis_label\', \'addAxis_ref\');';
if ($this->display === false) {
    echo '<script type="text/javascript">'.$script.'</script>';
} else {
    $this->headScript()->appendFile('scripts/ui/refRefactor.js', 'text/javascript');
    $this->headScript()->appendScript('$(document).ready(function(){'.$script.'});');
}
